<!DOCTYPE html>
<html style="height: 100%;">
<head>
<title>OpenBoundsViewer</title>
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>

<style type="text/css">

#featureList {
	float: left; 
	width: 30%; 
	overflow: scroll;
	height: 100%;   
}
#map {
	float:left; 
  	width: 70%;
  	height: 99%; 
}
.container {
    height: 200px; 
    width: 100%;

}
.miniMap {
    height: 100%; 
    width: 45%; 
    float: left;
}
.text {
    height: 100%;
    width: 40%; 
    float: left;
    padding-left:20px; 
    padding-right:20px; 

}
.button{
    height: 100%; 
    width: 5%; 
    float: left; 
}
</style>

<script>
function createTable(items){
    var table, row, cell; 
    table = document.createElement("table"); 
    table.id = "table"; 
    for (var p in items){
        row = table.insertRow(); 
        cell = row.insertCell(0); 
        cell.innerText = p; 
        cell.style.fontWeight = "bold";
        cell = row.insertCell(1); 
        cell.innerText = items[p]; 
    }
    return table; 
}

function loadJSON(url, callback) {   
    var xobj = new XMLHttpRequest();
    xobj.overrideMimeType("application/json");
    xobj.open('GET', url, true);
    xobj.onreadystatechange = function () {
        if (xobj.readyState == 4 && xobj.status == "200") {
            callback(JSON.parse(xobj.responseText));
        }
    };
    xobj.send(null);  
}

function loadMap(url,id) {
	var status = document.getElementById('button_' + String(id)).value; 
	if (status == false){
	
    	loadJSON(url, function(response){
    		
            var jsonLayer = L.geoJson(response, {
                onEachFeature: function(feature,layer){
                        var table = createTable(feature.properties);
                        layer.bindPopup(table);                  
                     }
            }).addTo(mapBig);   
 
            layers[id] = jsonLayer;  
 			document.getElementById('button_' + String(id)).value = true; 
			}); 
    }       	
	if (status == true){
		mapBig.removeLayer(layers[id]); 
		document.getElementById('button_' + String(id)).value = false; 
	}
}    	
</script>
</head>

<body style="height: 100%;">
    
    <div id="featureList"></div>
    <div id="map"></div> 

    <script type="text/javascript">
    baselayer = "http://tile.openstreetmap.org/{z}/{x}/{y}.png"; 
    var mapBig = L.map('map').setView([38,-100],5); 
    var layers = {};
    var streets =  L.tileLayer(baselayer, {
            attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',
            maxZoom: 17,
            zIndex:0
    });
    streets.addTo(mapBig);

    var base_url = "";
    var catalog = base_url + "catalog.geojson"; 
    loadJSON(catalog, function(response){
        var i = 0; 
        var geo = L.geoJson(response, {
            onEachFeature: function(feature,layer){

                // Creation of the feature container 
                var item = document.createElement("div");
                item.id = 'feature_' + String(i); 
                item.className = 'container'; 
                var parent = document.getElementById("featureList"); 
                parent.appendChild(item); 

                // Creation of a new container child for the map 
                var divMap = document.createElement("div"); 
                divMap.id = 'map_' + String(i); 
                divMap.className = 'miniMap'; 
                var parent = document.getElementById(item.id); 
                parent.appendChild(divMap); 
                // Add a leaflet map to the created "div" with an OSM baselayer
                var El = document.getElementById(divMap.id); 
                var map = L.map(El,{attributionControl: false}); 
                var streets =  L.tileLayer(baselayer, {
                    attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',
                    maxZoom: 17,
                    zIndex:0
                });
                streets.addTo(map);
                // Add the polygon feature (layer) to the newly created map 
                layer.addTo(map); 
                // Update the map to fit the feature 
                map.fitBounds(layer.getBounds());

               // Creation of a new container child for the text 
                var DivText = document.createElement("div"); 
                DivText.id = 'text_' + String(i); 
                DivText.className = 'text'; 
                DivText.innerHTML = '<b>' + (feature.properties.name || 'unnamed dataset') + '</b>' + '<br>' 
                                   + '<i>' + feature.properties.attribution +'</i>' + '<br>' 
                                   + feature.properties.feature_count + ' Features';         
 
                var parent = document.getElementById(item.id); 
                parent.appendChild(DivText); 

                var feature_url = base_url + feature.properties.path; 

                // Creation of a new container child for the button 
                var DivButton = document.createElement("div"); 
                DivButton.id = 'button_' + String(i); 
                DivButton.className = 'button'; 
                DivButton.value = false; 
                DivButton.innerHTML = '<input type="checkbox" onclick="loadMap(' + "'" + feature_url + "'"+ ',' + String(i) 
                					+ ');"/>';
                var parent = document.getElementById(item.id); 
                parent.appendChild(DivButton);               
                i++; 
                }
            }
        )

    });

    </script>

</body>
</html>
